\documentclass[../../../main_math.tex]{subfiles}

%break on finite difference equations

\begin{document}
\changecolor{NIPDE}
\begin{multicols}{2}[\section{Numerical integration of partial differential equations}]
  \subsection{Finite difference schemes}
  \subsubsection{Introduction}
  \begin{definition}
    A linear system of $n$ first order of pdes for $\vf{u}(t,x)$ is a system of the form: $$\vf{A}(t,x)\vf{u}_t+\vf{B}(t,x)\vf{u}_x=\vf{C}(t,x)\vf{u}+\vf{D}(t,x)$$
    for certain matrices $\vf{A},\vf{B},\vf{C}, \vf{D}\in \mathcal{M}_q(\RR)$. The system is called \emph{hyperbolic} if $\vf{A}^{-1}\vf{B}$ is diagonalizable.
  \end{definition}
  \begin{definition}
    Let $n\in\NN$, $m\in\ZZ$, $h,k>0$ and $\vf{u}:\RR^2\rightarrow\RR^q$ be a function. We define $\vf{u}_m^n:=\vf{u}(t_n,x_m)$, where $(t_n, x_m):=(nk,x_0+mh)$, $x_0\in\RR$. We denoted by $\vf{v}_m^n$ an approximation to $\vf{u}_m^n$. The set of points $G:=\{(t_n,x_m):n\in\NN,\ m\in\ZZ\}$ is called a \emph{grid}.
  \end{definition}
  \begin{definition}
    Let $G$ be a grid. A \emph{finite difference scheme} is a function $$\function{\vf{v}}{G}{\RR}{(t_n,x_m)}{\vf{v}_m^n}$$
    that aims to approximate $\vf{u}_m^n$, where $\vf{u}:\RR^2\rightarrow\RR^q$ is a function. Here $\vf{v}_m^n$ is a function of $\vf{v}_m^{n-j}$, $m\in\ZZ$, $j=0,\ldots,J-1$. The number $J$ is called \emph{number of steps}. If $J=1$, we say that the scheme is a \emph{one-step} scheme. Otherwise we say that the scheme is \emph{multi-step}.
  \end{definition}
  \begin{proposition}
    Consider the one dimensional homogeneous traffic equation of constant coefficients
    \begin{equation}\label{NIPDE:traffic}
      u_t+au_x=f
    \end{equation}
    where $a\in\RR$ and $f$ is a function.
    The following are satisfied:
    \begin{enumerate}
      \item \emph{Forward-time forward-space}:
            $$\frac{u_m^{n+1}-u_m^n}{k}+a\frac{u_{m+1}^n-u_m^n}{h}+\O{k}+\O{h}=f_m^n$$
      \item \emph{Forward-time backward-space}:
            $$\frac{u_m^{n+1}-u_m^n}{k}+a\frac{u_{m}^n-u_{m-1}^n}{h}+\O{k}+\O{h}=f_m^n$$
      \item \emph{Forward-time central-space}:
            $$\frac{u_m^{n+1}-u_m^n}{k}+a\frac{u_{m+1}^n-u_{m-1}^n}{2h}+\O{k}+\O{h^2}=f_m^n$$
      \item \emph{Leapfrog scheme}:
            \begin{multline*}
              \frac{u_m^{n+1}-u_m^{n-1}}{2k}+a\frac{u_{m+1}^n-u_{m-1}^n}{2h}+\\+\O{k^2}+\O{h^2}=f_m^n
            \end{multline*}
      \item \emph{Lax-Friedrichs scheme}:
            \begin{multline*}
              \frac{u_m^{n+1}-\frac{1}{2}(u_{m+1}^n+u_{m-1}^n)}{k}+a\frac{u_{m+1}^n-u_{m-1}^n}{2h} + \\ + \O{k}+\O{\frac{h^2}{k}}+\O{h^2}=f_m^n
            \end{multline*}
    \end{enumerate}
  \end{proposition}
  \begin{sproof}
    Use the Taylor expansion of $u(t,x)$.
  \end{sproof}
  \begin{corollary}
    Consider the traffic equation of \mcref{NIPDE:traffic} and let $\lambda:=k/h$. Then, we have the following schemes for approximating the solution:
    \begin{enumerate}
      \item Forward-time forward-space
            $$\displaystyle v_m^{n+1}=(1+\lambda a)v_m^n-\lambda av_{m+1}^n+kf_m^n$$
      \item Forward-time backward-space
            $$\displaystyle v_m^{n+1}=(1-\lambda a)v_m^n+\lambda av_{m-1}^n+kf_m^n$$
      \item Forward-time central-space
            $$\displaystyle v_m^{n+1}=v_m^n-\frac{\lambda a}{2}v_{m+1}^n+\frac{\lambda a}{2}v_{m-1}^n+kf_m^n$$
      \item Leapfrog scheme: $$v_m^{n+1}=v_m^{n-1}-\lambda av_{m+1}^n+\lambda av_{m-1}^n+kf_m^n$$
      \item Lax-Friedrichs scheme: $$v_m^{n+1}=\frac{1}{2}\left((1-\lambda a)v_{m+1}^n+(1+\lambda a)v_{m-1}^n\right)+kf_m^n$$
    \end{enumerate}
  \end{corollary}
  \subsubsection{Convergence and consistency}
  \begin{definition}
    A \emph{stability region} is a set $\Lambda\subseteq{\RR_{>0}}^2$ such that $(0,0)\in\Lambda'$, that is $(0,0)$ in an accumulation point.
  \end{definition}
  \begin{definition}
    Let $(G_j)$ be a sequence of grids such that the time and space steps $k_j,h_j>0$ of each one satisfy $\displaystyle \lim_{j\to\infty}k_j=\lim_{j\to\infty}h_j=0$.
    We say that a finite difference scheme $v$ approximating a pde with initial condition $u_0(x)$ is \emph{unconditionally convergent} if for any solution $u(x,t)$ to the pde we have:
    \begin{itemize}
      \item For all $x\in\domain u_0$ and all increasing sequence $(m_j)\in\NN$ such that $(\cdot,x_{m_j})\in G_j$ and $\displaystyle\lim_{j\to\infty} x_{m_j}=x$, we have $\displaystyle\lim_{j\to\infty} v_{m_j}^0=u_0(x)$.
      \item For all $(t,x)\in\domain u$ and all increasing sequences $(m_j),(n_j)\in\NN$ such that $(t_{n_j},x_{m_j})\in G_j$ and $\displaystyle\lim_{j\to\infty} x_{m_j}=x$, $\displaystyle\lim_{j\to\infty} t_{n_j}=t$, we have $\displaystyle\lim_{j\to\infty} v_{m_j}^{n_j}=u(t,x)$.
    \end{itemize}
    The scheme is \emph{conditionally convergent} if $\forall j\in\NN$, $(k_j,h_j)\in\Lambda$, for some stability region $\Lambda$.
  \end{definition}
  \begin{definition}
    Let $P$ be a partial differential operator and $\vf{f}$ be a function. Given the pde $P\vf{u}=\vf{f}$ and a finite difference scheme $P_{k,h}\vf{v}=R_{k,h}\vf{f}$ with $R_{k,h}\vf{1}=\vf{1}$, we say that the scheme is \emph{consistent} with the pde if for any smooth function $\vf\phi(t,x)$ we have: $$\lim_{k,h\to 0}R_{k,h}P\vf\phi-P_{k,h}\vf\phi=\vf{0}$$
    where the convergence is pointwise at each point $(t,x)$ in the domain of solutions. We say that the consistency is of order $(p,q)$ in time and space or order $r$ in $k=\lambda(h)$ if: $$\lim_{k,h\to 0}R_{k,h}P\vf\phi-P_{k,h}\vf\phi=\O{k^p}+\O{h^q}=\O{h^r}$$  The consistency is a \emph{conditional consistency} if the limit is for $(k,h)\in \Lambda$, for some stability region $\Lambda$.
  \end{definition}
  \begin{lemma}
    The Lax-Friedrichs scheme is consistent if and only if $\displaystyle\lim_{h,k\to 0}\frac{h^2}{k}=0$.
  \end{lemma}
  \subsubsection{Stability}
  \begin{definition}
    Let $P_{k,h}\vf{v}=0$ be a finite difference scheme with $J$ steps and $\Lambda$ be a stability region. We say that it is \emph{stable} is given $T>0$, there exists $C_T>0$ such that for any grid with $(k,h)\in \Lambda$ and for any initial values $\vf{v}_m^j$, $m\in\ZZ$, $j=0,\ldots,J-1$ we have $$\sum_{m\in\ZZ}\norm{\vf{v}_m^n}^2\leq C_T\sum_{j=0}^{J-1}\sum_{m\in\ZZ}\norm{\vf{v}_m^j}^2$$ for all $n\in\NN$ such that $0\leq nk\leq T$.
  \end{definition}
  \begin{lemma}
    If finite difference scheme of the form of $$\vf{v}_m^{n+1}=\alpha \vf{v}_m^n+\beta \vf{v}_{m+1}^n$$ satisfies $\abs{\alpha}+\abs{\beta}\leq 1$, then it is stable.
  \end{lemma}
  \begin{sproof}
    \begin{align*}
      \sum_{m\in\ZZ}\norm{\vf{v}_m^{n+1}}^2 & \leq \sum_{m\in\ZZ}\left(\abs{\alpha}^2\norm{\vf{v}_m^n}^2+2\abs{\alpha}\abs{\beta}\norm{\vf{v}_m^n}\cdot\right. \\
                                            & \hspace{2.5cm}\cdot\norm{\vf{v}_{m+1}^n}+\left.\abs{\beta}^2\norm{\vf{v}_{m+1}^n}^2\right)
      \\
                                            & \leq \sum_{m\in\ZZ}\left(\abs{\alpha}^2\norm{\vf{v}_m^n}^2+\abs{\alpha}\abs{\beta}(\norm{\vf{v}_m^n}^2 \right.+  \\
                                            & \hspace{2cm}\left.+\norm{\vf{v}_{m+1}^n}^2)+\abs{\beta}^2\norm{\vf{v}_{m+1}^n}^2\right)                          \\
                                            & = \sum_{m\in\ZZ}\left(\abs{\alpha}^2+2\abs{\alpha}\abs{\beta}+\abs{\beta}^2\right)\norm{\vf{v}_{m}^n}^2          \\
                                            & ={(\abs{\alpha}+\abs{\beta})}^2 \sum_{m\in\ZZ}\norm{\vf{v}_{m}^n}^2                                              \\
                                            & \leq{(\abs{\alpha}+\abs{\beta})}^{2(n+1)} \sum_{m\in\ZZ}\norm{\vf{v}_{m}^0}^2
    \end{align*}
  \end{sproof}
  \begin{theorem}[Courant-Friedrichs-Lewy condition]
    Consider the traffic equation $$\vf{u}_t+\vf{A}\vf{u}_x=0$$ with $\vf{A}\in\mathcal{M}_q(\RR)$ and a finite difference scheme of the form $$\vf{v}_m^{n+1}=\alpha \vf{v}_{m-1}^n+\beta \vf{v}_m^n+\gamma \vf{v}_{m+1}^n$$ with $k/h=\lambda=\const$ Then, if the scheme is convergent, we have $\abs{a_i\lambda}\leq 1$ $\forall a_i\in\sigma(\vf{A})$.
  \end{theorem}
  \begin{proof}
    Suppose $\abs{a_i\lambda}>1$ for some eigenvalue $a_i$ and let $\vf{u}_0(x)=\vf{c}\indi{\{\abs{x}> \frac{1}{\abs{\lambda}}\}}$ with $\vf{c}=(c_1,\ldots,c_q)$ and $c_i\ne 0$. As shown in figure \mcref{NIPDE:courant-friedrichs-lewy_fig} the numerical solution at $\vf{u}(1,0)$ will have the $i$-th component always equal to 0, whereas in general the exact solution won't be.
    \begin{figure}[H]
      \centering
      \includestandalone[mode=image|tex,width=\linewidth]{Images/courant-friedrichs-lewy}
      \caption{Finite difference scheme (blue) versus the characteristic lines (in red). The arrows inward a bullet come from the points from which it depends.}
      \label{NIPDE:courant-friedrichs-lewy_fig}
    \end{figure}
  \end{proof}
  % \begin{theorem}
  %   There are no explicit, unconditionally stable, consistent finite difference schemes for hyperbolic systems of partial differential equations.
  % \end{theorem}
  \subsubsection{Von Neumann stability analysis}
  \begin{definition}
    Let $P_{k,h}{v}={f}$ be a finite difference scheme. For each $n\in\NN$, let ${\hat{v}}^n\in L^2\left(\left[-\frac{\pi}{h},\frac{\pi}{h}\right]\right)$ be the function defined as the Fourier series: $${\hat{v}}^n(\xi)=\sum_{m\in\ZZ}{v}_{m}^n\exp{-\ii m h \xi}$$ Hence $\displaystyle {v}_m^n=\frac{h}{2\pi}\int_{-\pi/h}^{\pi/h} {\hat{v}}^n(\xi)\exp{\ii mh \xi}\dd{\xi}$. We denote by ${v}^n:=({v}_m^n)\in\ell^2(\ZZ)$ and ${\norm{v^n}_h}^2:=h{\norm{v^n}_{2}}^2$. We define the \emph{amplification factor} as the $2\pi$-periodic function in $\theta$, $g(\theta, k, h)$ that satisfies:
    $${\hat{v}}^{n+1}(\xi)=g(\xi h,k,h){\hat{v}}^n(\xi)$$
  \end{definition}
  \begin{theorem}
    Let $P_{k,h}{v}={f}$ be a one-step finite difference scheme with constant coefficients whose amplification factor $g(\theta,k,h)$ is continuous on $\RR\times\Lambda$, where $(k,h)\in\Lambda$ is a stability region. Then:
    \begin{enumerate}
      \item If $\exists K>0$ such that $\forall\theta\in\RR$ and $\forall(k,h)\in\Lambda$ we have $\abs{g(\theta,k,h)}\leq 1+Kk$, then the scheme is stable in $\Lambda$.
      \item If $\forall K>0$ and $\forall\varepsilon>0$ $\exists\theta\in\RR$ and $\exists(k,h)\in\Lambda$ with $k<\varepsilon$ such that $\abs{g(\theta, k,h)}>1+Kk$, then the scheme is unstable.
    \end{enumerate}
  \end{theorem}
  \begin{proof}
    \begin{enumerate}
      \item We have that $${\hat{v}}^{n}(\xi)={(g(\xi h,k,h))}^n{\hat{v}}^0(\xi)$$ Therefore applying twice the \mcref{MA:parseval}:
            \begin{align*}
              {\norm{{v}^n}_h}^2 & =h\sum_{m\in\ZZ}\abs{{v}_m^n}^2                                                     \\
                                 & =\frac{1}{2\pi}\int_{-\pi/h}^{\pi/h} \abs{\hat{v}^n(\xi)}^2\dd{\xi}                 \\
                                 & \leq{(1+Kk)}^{2n}\frac{1}{2\pi}\int_{-\pi/h}^{\pi/h} \abs{\hat{v}^0(\xi)}^2\dd{\xi} \\
                                 & ={(1+Kk)}^{2n} {\norm{{v}^0}_h}^2
            \end{align*}
            And note that $\forall T>0$ with $nk\leq T$ we have that:
            \begin{multline*}
              {(1+Kk)}^{2n}\leq{(1+Kk)}^{2\frac{T}{k}}={\left({(1+Kk)}^\frac{1}{Kk}\right)}^{2 K T}\leq\\\leq \exp{2K T}=:C_T
            \end{multline*}
            because $\sup_{x>0}{(1+x)}^{1/x}=\exp{}$.
      \item Let $T\geq 2$, $K>0$, and $\theta_0,h,k$ be the ones of the hypothesis with $\varepsilon=\min(1,\frac{1}{K})$. Hence, $k\leq 1$ and $Kk\leq 1$. By the continuity of $g$, $\exists \theta_1,\theta_2\in\RR$ such that $\abs{g(\theta, k,h)}>1+Kk$ $\forall\theta\in[\theta_1,\theta_2]$. Let $\hat{v}^0(\xi):=\sqrt{\frac{2\pi}{h(\theta_2-\theta_1)}}\indi{\left[\frac{\theta_1}{h},\frac{\theta_2}{h}\right]}$ and denote $v^0:=(v_m^0)\in\ell^2(\ZZ)$ its inverse transform. An easy check shows that $\norm{v^0}_h=1$. Now take $n:=\lfloor T/k \rfloor$. Thus:
            \begin{align*}
              {\norm{v^n}_h}^2 & =\frac{1}{2\pi}\int_{-\pi/h}^{\pi/h} \abs{\hat{v}^n(\xi)}^2\dd{\xi}                        \\
                               & =\frac{1}{2\pi}\int_{-\pi/h}^{\pi/h} \abs{g(h\xi, k,h)}^{2n}\abs{\hat{v}^0(\xi)}^2\dd{\xi} \\
                               & >{(1+Kk)}^{2n}                                                                             \\
                               & >{(1+Kk)}^{\frac{2}{k}}                                                                    \\
                               & ={\left({(1+Kk)}^{\frac{1}{Kk}}\right)}^{2K}                                               \\
                               & \geq 2^{2K}                                                                                \\
                               & =2^{2K}{\norm{v^0}_h}^2
            \end{align*}
            where the penultimate step is because $\inf_{x\in[0,1]}{(1+x)}^{1/x}=2$.
            Hence the scheme is unstable.
    \end{enumerate}
  \end{proof}
  \begin{corollary}
    Let $P_{k,h}{v}={f}$ be a one-step finite difference scheme with constant coefficients whose amplification factor $g(\theta,k,h)$ is continuous on $\RR\times\Lambda$, where $(k,h)\in\Lambda$ is a stability region. Then:
    \begin{enumerate}
      \item If $\abs{g(\theta,k,h)}\leq 1$ $\forall \theta$ and $\forall(k,h)\in\Lambda$, then the scheme is stable.
      \item If $\exists\theta_0\in\RR$ and $\delta>0$ such that $\abs{g(\theta_0,k,h)}>1+\delta$ $\forall(k,h)\in\Lambda$, then the scheme is unstable.
    \end{enumerate}
  \end{corollary}
  \begin{proposition}[Lax-Wendroff]
    Consider the traffic equation of \mcref{NIPDE:traffic}.
    The \emph{Lax-Wendroff scheme} is:
    \begin{multline*}
      \frac{u_m^{n+1}-u_{m}^n}{k}+a\frac{u_{m+1}^{n}-u_{m-1}^n}{2h}-\frac{a^2k}{2}\frac{u_{m+1}^n-2u_m^n+u_{m-1}^n}{h^2} \\ =\frac{f_m^{n+1}+f_m^n}{2}-\frac{ak}{4}\frac{f_{m+1}^n-f_{m-1}^n}{h}+\O{k^2}+\O{h^2}
    \end{multline*}
  \end{proposition}
  \begin{sproof}
    Expand $u(t+k,x)$ in Taylor series and use that:
    \begin{align*}
      u_t    & =-au_x+f            \\
      u_{tt} & =a^2u_{xx}-af_x+f_t
    \end{align*}
  \end{sproof}
  \begin{proposition}
    The Lax-Wendroff scheme is a one-step method that has order of consistency 2.
  \end{proposition}
  \begin{sproof}
    Show that $P_{k,h}\phi-R_{k,h}P\phi=\O{h^2}+\O{k^2}$ using a Taylor expansion and is stable if $a\lambda\leq 1$.
  \end{sproof}
  \begin{proposition}[Crank-Nicolson]
    Consider the traffic equation of \mcref{NIPDE:traffic}.
    The \emph{Crank-Nicolson scheme} is:
    \begin{multline*}
      \frac{u_m^{n+1}-u_{m}^n}{k}+a\frac{u_{m+1}^{n+1}-u_{m-1}^{n+1}+u_{m+1}^{n}-u_{m-1}^{n}}{4h}=\\ =\frac{f_m^{n+1}+f_m^n}{2}+\O{k^2}+\O{h^2}
    \end{multline*}
    Note that it is an implicit scheme.
  \end{proposition}
  \begin{proposition}
    The Crank-Nicolson scheme is a one-step method that has order of consistency 2 and it is unconditionally stable.
  \end{proposition}
  \begin{sproof}
    An easy check shows that:
    $$P_{k,h}\phi-R_{k,h}P\phi=\O{{(k+h)}^2}+\O{\frac{k^3}{h}}$$
    For the stability...
  \end{sproof}
  \begin{definition}
    Given scheme $P_{k,h}{v}={f}$, usually we cannot use the recurrence to compute the last term of the (finite) grid, with $n\in\{0,\ldots,N\}$ and $m\in\{0,\ldots,M\}$, $v_M^{n}$ for each $n\in\NN$. Thus the \emph{numerical boundary condition} is used in this cases. A numerical solution of order $p$ is a extrapolation of order $\O{h^p}$ of the last term of the grid in terms of the orther ones. Each $u(t,x-\ell h)$ can be expressed as: $$u(t,x-\ell h)=\sum_{k=1}^{p-1}\frac{{(-1)}^k \ell^kh^k}{k!}u^{(k)}+\O{h^p}$$
    If we want to get a linear approximation of the form
    $$u(t,x)=\sum_{k=1}^{p}\lambda_ku(x-kh)$$
    we need to solve the following linear system:
    $$
      \begin{pmatrix}
        1      & 1       & \cdots & 1             \\
        1      & 2       & \cdots & {(p-1)}       \\
        \vdots & \vdots  & \ddots & \vdots        \\
        1      & 2^{p-1} & \cdots & {(p-1)}^{p-1}
      \end{pmatrix}
      \begin{pmatrix}
        \lambda_1 \\
        \lambda_2 \\
        \vdots    \\
        \lambda_p
      \end{pmatrix}=
      \begin{pmatrix}
        1      \\
        0      \\
        \vdots \\
        0
      \end{pmatrix}
    $$
    Note that the solution always exists because the matrix is a Vandermonde matrix.
    For example, numerical boundary conditions of order 1, 2 and 3 are respectively:
    \begin{align*}
      v_M^{n} & =v_{M-1}^{n}                           \\
      v_M^n   & =2v_{M-1}^{n}-v_{M-2}^{n}              \\
      v_M^n   & =3v_{M-1}^{n}-3v_{M-2}^{n}+v_{M-3}^{n}
    \end{align*}
  \end{definition}
  \begin{proposition}\label{NIPDE:preLax}
    Consider the following initial value and boundary problem with constant coefficients:
    \begin{equation}\label{NIPDE:eqLax}
      \begin{cases}
        u_t=L(u)                                                                                                                    \\
        u(0,\vf{x})=u_0(\vf{x}) & \!\text{if }\vf{x}\in\Omega \subseteq\RR^n                                                        \\
        u(t,\vf{x})=g(t,\vf{x}) & \!\text{if }(t,\vf{x})\in[0,\infty)\times\partial\Omega_1\subseteq [0,\infty)\times\partial\Omega
      \end{cases}
    \end{equation}
    where $L$ is a differential operator and $g$ is a function. Let $M(\Omega)$ be the set of indices that we compute $\vf{v}^n=(v_m^n)_{m\in M(\Omega)}$. Consider a finite difference scheme of the form
    \begin{equation}\label{NIPDE:eqpreLax}
      \vf{B}_1\vf{v}^{n+1}=\vf{B}_0\vf{v}^n+\vf{f}^n
    \end{equation}
    where $\vf{B}_0$ and $\vf{B}_1$ are matrices and $\vf{f}^n$ is a vector. Then, the scheme is stable with stability region $\Lambda\subseteq \RR_{\geq 0}\times\RR$ if and only if $\forall T>0$ $\exists C_T>0$ such that $\forall (k,h)\in\Lambda$ and $\forall \ell\in\NN$ with $0\leq \ell k\leq T$ we have $\norm{{\left({\vf{B}_1}^{-1}\vf{B}_0\right)}^\ell}\leq C_T$.
  \end{proposition}
  \begin{proof}
    \begin{itemizeiff}
      We will prove by contradiction. Suppose that $\exists T>0$ such that $\forall C_T>0$ exist $(k,h)\in \Lambda$ and $\ell \in \NN$ with $0\leq \ell k\leq T$ such that $\norm{{\left({\vf{B}_1}^{-1}\vf{B}_0\right)}^\ell}> C_T$. Let $\vf{A}:= {\left({\vf{B}_1}^{-1}\vf{B}_0\right)}^\ell$. Then, taking $\vf{x^*}$ such that $\norm{\vf{x^*}}=1$ and $\norm{A}=\norm{\vf{A}\vf{x^*}}$ we have that for any $\vf{v}^0$, defining $\vf{w}^0:=\vf{v}^0+\vf{x^*}$ we have that:
      \begin{multline*}
        \norm{\vf{v}^\ell -\vf{w}^\ell}= \norm{\vf{A} \vf{x^*}}=\norm{A}>C_T\norm{\vf{v}^0-\vf{w}^0}
      \end{multline*}
      where the first equality follows from expanding recursively the norm $\norm{\vf{v}^\ell -\vf{w}^\ell}$. Hence the scheme is not stable.
      \item An easy check show that if $\vf{v}^0$ and $\vf{w}^0$ are such that satisfy the recurrence of \mcref{NIPDE:eqpreLax}, then ${\vf{v}^\ell -\vf{w}^\ell}=\vf{A}(\vf{v}^0-\vf{w}^0)$. So if
      $$
        \norm{\vf{v}^\ell -\vf{w}^\ell}\leq C_T\norm{\vf{v}^0-\vf{w}^0}
      $$
      then necessarily $\norm{\vf{A}}\leq C_T$.
    \end{itemizeiff}
  \end{proof}
  \begin{theorem}[Lax-Richtmyer equivalence theorem]
    Consider the problem of \mcref{NIPDE:eqLax} and define
    $$
      \vf{T}^n:=\vf{B}_1\vf{u}^{n+1}-\vf{B}_0\vf{u}^n -\vf{f}^n
    $$
    Suppose that:
    \begin{enumerate}
      \item $\norm{\vf{T}^n}=\O{k^p+\norm{\vf{h}}^q}$ independent of $n$ and $\forall (k,h)\in\Lambda$ and all $(t,x)\in[0,T]\times\Omega$.
      \item $\forall (k,h)\in\Lambda$, $\vf{B}_1$ is invertible and $\norm{{\vf{B}_1}^{-1}}\leq C_1k$ for certain $C_1>0$ independent of $(k,h)$.
      \item The scheme is stable.
      \item $\vf{v}^0$ is such that $\norm{\vf{v}^0-\vf{u}^0}=\O{k^p+\norm{\vf{h}}^q}$ uniformly for $(k,h)\in\Lambda$ and $(t,x)\in[0,T]\times\Omega$.
    \end{enumerate}
    Then, $\forall n\in\NN$ with $0\leq nk\leq T$ we have:
    $$
      \norm{\vf{v}^n-\vf{u}^n}=\O{k^p+\norm{\vf{h}}^q}
    $$
    uniformly for $(k,h)\in\Lambda$ and $(t,x)\in[0,T]\times\Omega$.
  \end{theorem}
  \begin{proof}
    We have that
    \begin{align*}
      \vf{B}_1\vf{v}^{n} & =\vf{B}_0\vf{v}^{n-1}+\vf{f}^{n-1}               \\
      \vf{B}_1\vf{u}^{n} & =\vf{B}_0\vf{u}^{n-1} +\vf{f}^{n-1}+\vf{T}^{n-1}
    \end{align*}
    Then if $\vf{A}= {\vf{B}_1}^{-1}\vf{B}_0$ we have that
    $$\vf{v}^n-\vf{u}^n=\vf{A}^n(\vf{v}^0-\vf{u}^0)-\sum_{\ell=0}^{n-1}\vf{A}^{n-1-\ell}{\vf{B_1}}^{-1}\vf{T}^\ell$$
    And so:
    $$
      \norm{\vf{v}^n-\vf{u}^n}\leq C_T \O{k^p+\norm{\vf{h}}^q}+\sum_{\ell=0}^{n-1}C_T C_1k\O{k^p+\norm{\vf{h}}^q}
    $$
    where we have used \mcref{NIPDE:preLax} for noting that $\forall\ell=0,\ldots,n-1$ $\norm{\vf{A}^{n-1-\ell}}\leq C_T$.
    Finally observe that $kn\leq T$ and the uniformity of the $\O{k^p+\norm{\vf{h}}^q}$ allows us to conclude the proof.
  \end{proof}
  \begin{remark}
    It can also be shown that the consistency and convergence imply stability.
  \end{remark}
  \begin{theorem}
    Consider a scheme of $J$ steps for a 1st-order-in-time linear pde of constant coefficients whose amplification factor is $g$. Let $\Phi(\theta, g)$ be the \emph{amplification polynomial}, that is the polynomial that satisfies $g$ of degree $J-1$. Then, the scheme is stable if and only if for any root $g_j(\theta)$ of $\Phi$ we have $\abs{g_j(\theta)}\leq 1$ and if $\exists \theta_0$ and $k$ such that $\abs{g_k(\theta_0)}=1$ then this root is simple.
  \end{theorem}
  \subsubsection{Second order pdes}
  \begin{definition}
    Consider a second order pde of the form:
    \begin{equation}
      A u_tt+2Bu_{tx} +Cu_{xx}+Du_t+Eu_x+F u=G
    \end{equation}
    where $A,B,C,D,E,F,G:\RR^2\rightarrow\RR$ are smooth functions. The ivp defined in a curve $\gamma(s)=(t,x)=(f(s),g(s))$ is given by the extra conditions:
    $$
      \begin{cases}
        u(f(s),g(s))=h(s)      \\
        u_t(f(s),g(s))=\phi(s) \\
        u_x(f(s),g(s))=\psi(s)
      \end{cases}
    $$
    which are tied to the \emph{compatibility condition} $h'=\phi f'+\psi g'$ that follows from the chain rule. The characteristic curves are the curves from which we cannot find the highest order derivatives of $u$ from the initial conditions and the pde. Differentiating $u_t(s)$ and $u_x(s)$ we get the system of equations for $u_tt$, $u_{tx}$ and $u_{xx}$:
    \begin{equation*}
      \begin{cases}
        A u_tt+2Bu_{tx} +Cu_{xx}=G-D\phi-E\psi -Fh \\
        f'u_{tt}+g'u_{tx}=\phi'                    \\
        f'u_{tx}+g'u_{xx}=\psi'
      \end{cases}
    \end{equation*}
    The determinant of the matrix associated of the system is $\Delta=A{(g')}^2-2Bf'g'+C{(f')}^2$. Equating this determinant to zero and using the chain rule we get:
    $$
      A{\left(\dv{x}{t}\right)}^2-2B\dv{x}{t}+C=0
    $$
    The pde is called \emph{elliptic} if $AC-B^2>0$, \emph{hyperbolic} if $AC-B^2<0$ and \emph{parabolic} if $AC-B^2=0$.
  \end{definition}
  \begin{definition}
    Consider a finite difference scheme with $J$ steps for a 2n order homogeneous pde and $\Lambda$ be a stability region. We say that it is \emph{stable} is given $T>0$, there exists $C_T>0$ such that for any grid with $(k,h)\in \Lambda$ and for any initial values $\vf{v}_m^j$, $m\in\ZZ$, $j=0,\ldots,J-1$ we have $$\sum_{m\in\ZZ}\norm{\vf{v}_m^n}^2\leq (1+n^2)C_T\sum_{j=0}^{J-1}\sum_{m\in\ZZ}\norm{\vf{v}_m^j}^2$$ for all $n\in\NN$ such that $0\leq nk\leq T$.
  \end{definition}
  \begin{theorem}
    Consider a finite difference scheme with $J$ steps for a 2n order homogeneous pde whose amplification factor is $g$ and $\Phi(\theta, g)$ is the amplification polynomial. Then, the scheme is stable if and only if for any root $g_j(\theta)$ of $\Phi$ we have $\abs{g_j(\theta)}\leq 1$ and if $\exists \theta_0$ and $k$ such that $\abs{g_k(\theta_0)}=1$ then this root is at most double.
  \end{theorem}
  \subsubsection{Parabolic equations}
  \begin{proposition}
    Consider the heat equation $u_t=\alpha u_{xx}+f$. We have the following schemes for approximating the solution:
    \begin{enumerate}
      \item \emph{Forward-time central-space}:
            $$\frac{v_m^{n+1}-v_m^n}{k}=\alpha\frac{v_{m+1}^n-2v_m^n+v_{m-1}^n}{h^2}+f_m^n$$
      \item \emph{Backward-time central-space}:
            $$\frac{v_m^{n+1}-v_m^n}{k}=\alpha\frac{v_{m+1}^{n+1}-2v_m^{n+1}+v_{m-1}^{n+1}}{h^2}+f_m^{n+1}$$
      \item \emph{Crank-Nicolson scheme}:
            \begin{multline*}
              \frac{v_m^{n+1}-v_m^n}{k}=\frac{\alpha}{2}\frac{v_{m+1}^n-2v_m^n+v_{m-1}^n}{h^2}+\\+\frac{\alpha}{2}\frac{v_{m+1}^{n+1}-2v_m^{n+1}+v_{m-1}^{n+1}}{h^2}+\frac{1}{2}(f_m^{n+1}+f_m^n)
            \end{multline*}
      \item \emph{Leapfrog scheme}:
            \begin{equation*}
              \frac{u_m^{n+1}-u_m^{n-1}}{2k}=\alpha\frac{v_{m+1}^n-2v_m^n+v_{m-1}^n}{h^2}+f_m^n
            \end{equation*}
      \item \emph{Du-Fort-Frankel scheme}:
            \begin{equation*}
              \frac{v_m^{n+1}-v_m^{n-1}}{2k}=\alpha\frac{v_{m+1}^{n}-[v_m^{n+1}\!+\!v_m^{n-1}]+v_{m-1}^{n}}{h^2}+f_m^{n}
            \end{equation*}
    \end{enumerate}
  \end{proposition}
  \subsubsection{Elliptic equations}
  \begin{definition}
    Let $Pu=f$ be an elliptic pde on $\Omega$. We define the following boundary conditions on $\Fr{\Omega}$:
    \begin{enumerate}
      \item \emph{Dirichlet}: $u=f$
      \item \emph{Neumann}: $\pdv{u}{n}=g$
      \item \emph{Robin}: $\alpha u+\pdv{u}{n}=h$
    \end{enumerate}
  \end{definition}
  \begin{definition}
    Consider the following scheme for the Poisson equation $u_{xx}+u_{yy}=f$:
    \begin{equation}\label{NIPDE:poisson_eq}
      \frac{v_{\ell+1,m}-2v_{\ell,m}+v_{\ell-1,m}}{h^2}+\frac{v_{\ell,m+1}-2v_{\ell,m}+v_{\ell,m-1}}{h^2}\!=\!f_{\ell,m}
    \end{equation}
    where we have chosen the same step size $h$ for both $x$ and $y$ directions. We define the \emph{discrete laplacian} as:
    $$
      {(\laplacian_h v)}_{\ell,m}:=\frac{v_{\ell+1,m}+v_{\ell-1,m}+v_{\ell,m+1}+v_{\ell,m-1}-4v_{\ell,m}}{h^2}
    $$
    Note that $\laplacian_hv=f$.
  \end{definition}
  \begin{theorem}[Discrete maximum principle]\label{NIPDE:maximumPrinc}
    Consider the Poisson equation $u_{xx}+u_{yy}=f$, $v$ be a scheme of \mcref{NIPDE:poisson_eq} and suppose that $\laplacian_hv\geq 0$ on a region $\Omega$. Then:
    $$\max_{\overline{\Omega}} v=\max_{\Fr{\Omega}} v$$
  \end{theorem}
  \begin{sproof}
    The condition $\laplacian_hv\geq 0$ is equivalent to:
    $$
      v_{\ell,m}\leq \frac{1}{4}(v_{\ell+1,m}+v_{\ell-1,m}+v_{\ell,m+1}+v_{\ell,m-1})
    $$
    Now note that if there is a maximum in the interior of the region, its four neighbours must be equal to it.
  \end{sproof}
  \begin{corollary}[Discrete minimum principle]\label{NIPDE:minimumPrinc}
    Consider the Poisson equation $u_{xx}+u_{yy}=f$, $v$ be a scheme of \mcref{NIPDE:poisson_eq} and suppose that $\laplacian_hv\leq 0$ on a region $\Omega$. Then:
    $$\min_{\overline{\Omega}} v=\min_{\Fr{\Omega}} v$$
  \end{corollary}
  \begin{proof}
    Apply \mnameref{NIPDE:maximumPrinc} to $-v$.
  \end{proof}
  \begin{theorem}\label{NIPDE:pois_bound_V}
    Consider the Poisson equation $u_{xx}+u_{yy}=f$, $v$ be a scheme of \mcref{NIPDE:poisson_eq} defined on $\Omega={[0,1]}^2$. If $v=0$ on $\Fr{\Omega}$ then:
    $$
      \norm{v}_\infty\leq \frac{1}{8}\norm{\laplacian_h v}_\infty
    $$
  \end{theorem}
  \begin{proof}
    From $\laplacian_h v_{\ell,m}=f_{\ell,m}$ in the internal nodes of the grid, we have that $\abs{\laplacian_h v}\leq \norm{f}_\infty$. Now consider the non-negative function $w_{\ell,m}$ defined as:
    $$
      w_{\ell,m}:= \frac{1}{4}\left[{\left(x_\ell-1/2\right)}^2+{\left(y_m-1/2\right)}^2\right]
    $$
    An easy check shows that $\laplacian_h w_{\ell,m}=1$ and $\norm{w}_{L^\infty(\Fr{\Omega})}=\frac{1}{8}$. So on the one hand, $\laplacian_h(v-\norm{f}_\infty w)\leq 0$ and by the \mnameref{NIPDE:minimumPrinc}:
    $$
      -\norm{f}_\infty\norm{w}_{L^\infty(\Fr{\Omega})}\leq v_{\ell,m}-\norm{f} w_{\ell,m}\leq v_{\ell,m}
    $$
    And on the other hand, $\laplacian_h(v+\norm{f}_\infty w)\geq 0$ and by the \mnameref{NIPDE:maximumPrinc}:
    $$
      \norm{f}_\infty\norm{w}_{L^\infty(\Fr{\Omega})}\geq v_{\ell,m}
    $$
    Thus:
    $$
      \norm{v}_\infty\leq \norm{w}_{L^\infty(\Fr{\Omega})}\norm{f}_\infty= \frac{1}{8}\norm{\laplacian_h v}_\infty
    $$
  \end{proof}
  \begin{theorem}
    Let $u$ be the solution to $\laplacian u=f$ with Dirichlet boundary condition on the unit square and let $v_{\ell,m}$ be the solution to $\laplacian_h v=f_{\ell,m}$ with $v_{\ell,m}=u(x_\ell,y_m)$ on the boundary. Then:
    $$
      \norm{u-v}_\infty\leq C h^2\norm{\partial^4u}_\infty
    $$
    for some constant $C\in\RR$, where $\norm{\partial^4u}_\infty:=\max\left\{\norm{{\partial_x}^4u}_\infty,\norm{{\partial_y}^4u}_\infty\right\}$
  \end{theorem}
  \begin{proof}
    Note that $\laplacian_h u=f+\varepsilon$, with $\abs{\varepsilon}\leq \tilde{C} h^2\norm{\partial^4u}_\infty$ for some constant $\tilde{C}\in\RR$. Since $u-v=0$ on the boundary, by \mcref{NIPDE:pois_bound_V} we have:
    $$
      \norm{u-v}_\infty\leq\frac{1}{8}\norm{f+\varepsilon -f}_\infty\leq C h^2\norm{\partial^4u}_\infty
    $$
  \end{proof}
  \subsection{Introduction to finite element methods}
  \begin{definition}
    The \emph{finite element method} is one of the most popular, general,
    powerful and elegant approaches for approximating the solutions of
    PDEs. Unlike finite difference methods, it naturally handles complicated domains (useful for engines and aeroplanes) and minimally
    regular data (such as discontinuous forcing terms).

    There are four basic ingredients in the finite element method:
    \begin{enumerate}
      \item A variational formulation of the problem in an infinite-dimensional space $V$.
      \item A variational formulation of the problem in a finite-dimensional space $V_h\subset V$.
      \item The construction of a basis for $V_h$.
      \item The assembly and solution of the resulting linear system of equations.
    \end{enumerate}
  \end{definition}
  \subsubsection{The variational formulation}
  \begin{definition}
    Let $\Omega\subseteq \RR^n$ be an open bounded connected set such that $\Fr{U}$ is of class $\mathcal{C}^1$, $f\in\mathcal{C}(\Omega)$ and $g\in\mathcal{C}(\Fr{\Omega})$. Consider the following Dirichlet problem of finding $u\in\mathcal{C}^2(\Omega)\cap \mathcal{C}(\overline{\Omega})$ such that:
    \begin{equation}\label{NIPDE:Dirichlet}
      \begin{cases}
        -\laplacian{u} = f & \text{in $U$}      \\
        u=0                & \text{on $\Fr{U}$}
      \end{cases}
    \end{equation}
    Let
    $$V:=\{v:\Omega\rightarrow\RR:\norm{v}_{L^2(\Omega)}+\norm{\grad{v}}_{L^2(\Omega)}<\infty, v|_{\Fr{\Omega}}=0\}$$
    The \emph{variational formulation} of the problem is to find $u\in V$ such that:
    \begin{equation}\label{NIPDE:varDirichlet}
      \int_\Omega \grad{u}\cdot\grad{v}\dd{x}=\int_\Omega fv\dd{x}\quad\forall v\in V
    \end{equation}
  \end{definition}
  \begin{remark}
    The variational formulation can be obtained by multiplying \cref{NIPDE:Dirichlet} by $v$ and the use the \mnameref{PDE:greenidentities}.
  \end{remark}
  \begin{lemma}
    If $u\in V$ is a solution to \cref{NIPDE:varDirichlet}, then $u$ is a solution to \cref{NIPDE:Dirichlet}.
  \end{lemma}
  \begin{theorem}
    If $f\in \mathcal{C}(\Omega)$, then the solutions to \cref{NIPDE:varDirichlet} are $\mathcal{C}^2(\Omega)$.
  \end{theorem}
  \begin{definition}[Galerkin approximation]
    Let $V_h\subset V$ be a finite-dimensional subspace of $V$. The \emph{Galerkin approximation} of \cref{NIPDE:varDirichlet} is to find $u_h\in V_h$ such that:
    \begin{equation}\label{NIPDE:Galerkin}
      \int_\Omega \grad{u_h}\cdot\grad{v_h}\dd{x}=\int_\Omega fv_h\dd{x}\quad\forall v_h\in V_h
    \end{equation}
  \end{definition}
  \subsubsection{Construction of function spaces}
  \begin{definition}[Mesh]
    A \emph{mesh} is a geometric decomposition of a domain $\Omega$ into a finite collection of \emph{cells} ${\{K_i\}}_{i=1}^N$ such that:
    \begin{enumerate}
      \item $\Int(K_i) \cap \Int(K_j) = \varnothing$ for all $i\neq j$.
      \item $\bigcup_{i=1}^N K_i = \overline{\Omega}$.
    \end{enumerate}
    The cells are usually chosen to be $n$-simplices or $n$-parallelepipeds.
  \end{definition}
  \begin{definition}
    The \emph{finite element method} is a particular choice of Galerkin approximation, where the discrete function space
    $V_h$ is:
    \begin{multline*}
      V_h:=\{v\in\mathcal{C}(\Omega):v\text{ is piecewise linear when restricted}\\\text{to a cell}\}
    \end{multline*}
    Note that the functions in $V_h$ are uniquely determined by its values at the vertices of the cell. The vertices of the cells are called \emph{nodes}.
  \end{definition}
  \begin{definition}
    Given the location $x_i$ of $M$ \emph{nodes} in $\Int\Omega$, we define the \emph{nodal basis} $(\phi_1,\ldots,\phi_M)$ as the functions $\phi_i$ such that:
    $$\phi_i(x_j)=\delta_{ij}$$
  \end{definition}
  \subsubsection{Linear algebraic formulation}
  \begin{proposition}
    Given a mesh of $\Omega$, consider the space $V_h\subset V$ and its associate nodal basis. Suppose:
    $$
      u_h=\sum_{i=1}^M u_i\phi_i\qquad v_h=\sum_{i=1}^M v_i\phi_i
    $$
    Then, if $\vf{u}=\transpose{(u_1,\ldots,u_M)}$ we have:
    $$\vf{Au}=\vf{b}$$
    where $\vf{A}=(a_{ij})$ and $\vf{b}=(b_i)$ are defined as:
    \begin{equation*}
      a_{ij} =\int_\Omega \grad{\phi_i}\cdot\grad{\phi_j}\dd{x} \qquad b_i    =\int_\Omega f\phi_i\dd{x}
    \end{equation*}
  \end{proposition}
  \begin{proof}
    Since, $u_h\in V_h$, and using the linearity of the integral we have:
    \begin{align*}
      \int_\Omega \grad{u_h}\cdot\grad{v_h}\dd{x}                     & =\int_\Omega f v_h\dd{x}                    \\
      \sum_{i=1}^M v_i \int_\Omega \grad{u_h}\cdot\grad{\phi_i}\dd{x} & =\sum_{i=1}^M v_i \int_\Omega f\phi_i\dd{x}
    \end{align*}
    As this holds for all $v_h\in V_h$, we have that this is equivalent to
    $$\int_\Omega \grad{u_h}\cdot\grad{\phi_i}\dd{x} =\int_\Omega f\phi_i\dd{x}$$
    which implies:
    $$\sum_{j=1}^M u_j \int_\Omega \grad{\phi_j}\cdot\grad{\phi_i}\dd{x} =\int_\Omega f\phi_i\dd{x}$$
  \end{proof}
  %   Let $\Omega\subset\RR^2n$ be a bounded domain with a polygonal boundary. Thus, $\Omega$ can be exactly covered by a finite number of triangles. It will be assumed that any pair of triangles in a triangulation of $\Omega$ intersect along a complete edge, at a vertex, or not at all, as shown in Fig. 2.3. We will denote by $h_K$ the diameter (longest side) of the triangle $K$, and we define $h = \max_K h_K$. We define the associate basis functions 
  % \end{definition}
\end{multicols}
\end{document}