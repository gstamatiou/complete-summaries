\documentclass[../../../main_math.tex]{subfiles}

%break on finite difference equations

\begin{document}
\changecolor{NIPDE}
\begin{multicols}{2}[\section{Numerical integration of partial differential equations}]
  \subsection{Finite difference schemes}
  \subsubsection{Introduction}
  \begin{definition}
    A linear system of $n$ first order of pdes for $\vf{u}(t,x)$ is a system of the form: $$\vf{A}(t,x)\vf{u}_t+\vf{B}(t,x)\vf{u}_x=\vf{C}(t,x)\vf{u}+\vf{D}(t,x)$$
    for certain matrices $\vf{A},\vf{B},\vf{C}, \vf{D}\in \mathcal{M}_q(\RR)$. The system is called \emph{hyperbolic} if $\vf{A}^{-1}\vf{B}$ is diagonalizable.
  \end{definition}
  \begin{definition}
    Let $n\in\NN$, $m\in\ZZ$, $h,k>0$ and $\vf{u}:\RR^2\rightarrow\RR^q$ be a function. We define $\vf{u}_m^n:=\vf{u}(t_n,x_m)$, where $(t_n, x_m):=(nk,x_0+mh)$, $x_0\in\RR$. We denoted by $\vf{v}_m^n$ an approximation to $\vf{u}_m^n$. The set of points $G:=\{(t_n,x_m):n\in\NN,\ m\in\ZZ\}$ is called a \emph{grid}.
  \end{definition}
  \begin{definition}
    Let $G$ be a grid. A \emph{finite difference scheme} is a function $$\function{\vf{v}}{G}{\RR}{(t_n,x_m)}{\vf{v}_m^n}$$
    that aims to approximate $\vf{u}_m^n$, where $\vf{u}:\RR^2\rightarrow\RR^q$ is a function. Here $\vf{v}_m^n$ is a function of $\vf{v}_m^{n-j}$, $m\in\ZZ$, $j=0,\ldots,J-1$. The number $J$ is called \emph{number of steps}. If $J=1$, we say that the scheme is a \emph{one-step} scheme. Otherwise we say that the scheme is \emph{multi-step}.
  \end{definition}
  \begin{proposition}
    Consider the one dimensional homogeneous traffic equation of constant coefficients
    \begin{equation}\label{NIPDE:traffic}
      u_t+au_x=f
    \end{equation}
    where $a\in\RR$ and $f$ is a function.
    The following are satisfied:
    \begin{enumerate}
      \item $\displaystyle\frac{u_m^{n+1}-u_m^n}{k}+a\frac{u_{m+1}^n-u_m^n}{h}+\O{k}+\O{h}=f_m^n$
      \item $\displaystyle\frac{u_m^{n+1}-u_m^n}{k}+a\frac{u_{m}^n-u_{m-1}^n}{h}+\O{k}+\O{h}=f_m^n$
      \item $\displaystyle\frac{u_m^{n+1}-u_m^n}{k}+a\frac{u_{m+1}^n-u_{m-1}^n}{2h}+\O{k}+\O{h^2}=f_m^n$
      \item \emph{Leapfrog scheme}:
            \begin{multline*}
              \frac{u_m^{n+1}-u_m^{n-1}}{2k}+a\frac{u_{m+1}^n-u_{m-1}^n}{2h}+\\+\O{k^2}+\O{h^2}=f_m^n
            \end{multline*}
      \item \emph{Lax-Friedrichs scheme}:
            \begin{multline*}
              \frac{u_m^{n+1}-\frac{1}{2}(u_{m+1}^n+u_{m-1}^n)}{k}+a\frac{u_{m+1}^n-u_{m-1}^n}{2h} + \\ + \O{k}+\O{\frac{h^2}{k}}+\O{h^2}=f_m^n
            \end{multline*}
    \end{enumerate}
  \end{proposition}
  \begin{sproof}
    Use the Taylor expansion of $u(t,x)$.
  \end{sproof}
  \begin{corollary}
    Consider the traffic equation of \mcref{NIPDE:traffic} and let $\lambda:=k/h$. Then, we have the following schemes for approximating the solution:
    \begin{enumerate}
      \item $\displaystyle v_m^{n+1}=(1+\lambda a)v_m^n-\lambda av_{m+1}^n+f_m^n$
      \item $\displaystyle v_m^{n+1}=(1-\lambda a)v_m^n+\lambda av_{m+1}^n+f_m^n$
      \item $\displaystyle v_m^{n+1}=v_m^n-\frac{\lambda a}{2}v_{m+1}^n+\frac{\lambda a}{2}v_{m-1}^n+f_m^n$
      \item Leapfrog scheme: $$v_m^{n+1}=v_m^{n-1}-\lambda av_{m+1}^n+\lambda av_{m-1}^n+f_m^n$$
      \item Lax-Friedrichs scheme: $$v_m^{n+1}=\frac{1}{2}\left((1-\lambda a)v_{m+1}^n+(1+\lambda a)v_{m-1}^n\right)+f_m^n$$
    \end{enumerate}
  \end{corollary}
  \subsubsection{Convergence and consistency}
  \begin{definition}
    A \emph{stability region} is a set $\Lambda\subseteq{\RR_>0}^2$ such that $(0,0)\in\Lambda'$, that is $(0,0)$ in an accumulation point.
  \end{definition}
  \begin{definition}
    Let $(G_j)$ be a sequence of grids such that the time and space steps $k_j,h_j>0$ of each one satisfy $\displaystyle \lim_{j\to\infty}k_j=\lim_{j\to\infty}h_j=0$.
    We say that a finite difference scheme $v$ approximating a pde with initial condition $u_0(x)$ is \emph{unconditionally convergent} if for any solution $u(x,t)$ to the pde we have:
    \begin{itemize}
      \item For all $x\in\domain u_0$ and all increasing sequence $(m_j)\in\NN$ such that $(\cdot,x_{m_j})\in G_j$ and $\displaystyle\lim_{j\to\infty} x_{m_j}=x$, we have $\displaystyle\lim_{j\to\infty} v_{m_j}^0=u_0(x)$.
      \item For all $(t,x)\in\domain u$ and all increasing sequences $(m_j),(n_j)\in\NN$ such that $(t_{n_j},x_{m_j})\in G_j$ and $\displaystyle\lim_{j\to\infty} x_{m_j}=x$, $\displaystyle\lim_{j\to\infty} t_{n_j}=t$, we have $\displaystyle\lim_{j\to\infty} v_{m_j}^{n_j}=u(t,x)$.
    \end{itemize}
    The scheme is \emph{conditionally convergent} if $\forall j\in\NN$, $(k_j,h_j)\in\Lambda$, for some stability region $\Lambda$.
  \end{definition}
  \begin{definition}
    Let $P$ be a partial differential operator and $\vf{f}$ be a function. Given the pde $P\vf{u}=\vf{f}$ and a finite difference scheme $P_{k,h}\vf{v}=\vf{f}$, we say that the scheme is \emph{consistent} with the pde if for any smooth function $\vf\phi(t,x)$ we have: $$\lim_{k,h\to 0}P\vf\phi-P_{k,h}\vf\phi=\vf{0}$$
    where the convergence is pointwise at each point $(t,x)$ in the domain of solutions.
  \end{definition}
  \begin{lemma}
    The Lax-Friedrichs scheme is consistent if and only if $\displaystyle\lim_{h,k\to 0}\frac{h^2}{k}=0$.
  \end{lemma}
  \subsubsection{Stability}
  \begin{definition}
    Let $P_{k,h}\vf{v}=0$ be a finite difference scheme with $J$ steps and $\Lambda$ be a stability region. We say that it is \emph{stable} is given $T>0$, there exists $C_T>0$ such that for any grid with $(k,h)\in \Lambda$ and for any initial values $\vf{v}_m^j$, $m\in\ZZ$, $j=0,\ldots,J-1$ we have $$\sum_{m\in\ZZ}\norm{\vf{v}_m^n}^2\leq C_T\sum_{j=0}^{J-1}\sum_{m\in\ZZ}\norm{\vf{v}_m^j}^2$$ for all $n\in\NN$ such that $0\leq nk\leq T$.
  \end{definition}
  \begin{lemma}
    If finite difference scheme of the form of $$\vf{v}_m^{n+1}=\alpha \vf{v}_m^n+\beta \vf{v}_{m+1}^n$$ satisfies $\abs{\alpha}+\abs{\beta}\leq 1$, then it is stable.
  \end{lemma}
  \begin{sproof}
    \begin{align*}
      \sum_{m\in\ZZ}\norm{\vf{v}_m^{n+1}}^2 & \leq \sum_{m\in\ZZ}\left(\abs{\alpha}^2\norm{\vf{v}_m^n}^2+2\abs{\alpha}\abs{\beta}\norm{\vf{v}_m^n}\cdot\right. \\
                                            & \hspace{2.5cm}\cdot\norm{\vf{v}_{m+1}^n}+\left.\abs{\beta}^2\norm{\vf{v}_{m+1}^n}^2\right)
      \\
                                            & \leq \sum_{m\in\ZZ}\left(\abs{\alpha}^2\norm{\vf{v}_m^n}^2+\abs{\alpha}\abs{\beta}(\norm{\vf{v}_m^n}^2 \right.+  \\
                                            & \hspace{2cm}\left.+\norm{\vf{v}_{m+1}^n}^2)+\abs{\beta}^2\norm{\vf{v}_{m+1}^n}^2\right)                          \\
                                            & = \sum_{m\in\ZZ}\left(\abs{\alpha}^2+2\abs{\alpha}\abs{\beta}+\abs{\beta}^2\right)\norm{\vf{v}_{m}^n}^2          \\
                                            & ={(\abs{\alpha}+\abs{\beta})}^2 \sum_{m\in\ZZ}\norm{\vf{v}_{m}^n}^2                                              \\
                                            & \leq{(\abs{\alpha}+\abs{\beta})}^{2(n+1)} \sum_{m\in\ZZ}\norm{\vf{v}_{m}^0}^2
    \end{align*}
  \end{sproof}
  \begin{theorem}[Lax-Richtmyer equivalence theorem]
    Consider and well-posed linear and of constant coefficients ivp of 1st order in time and let $P_{k,h}\vf{v}=\vf{f}$ be a consistent finite difference scheme for it. Then, the scheme is convergent if and only if it is stable.
  \end{theorem}
  \begin{theorem}[Courant-Friedrichs-Lewy condition]
    Consider the traffic equation $$\vf{u}_t+\vf{A}\vf{u}_x=0$$ with $\vf{A}\in\mathcal{M}_q(\RR)$ and a finite difference scheme of the form $$\vf{v}_m^{n+1}=\alpha \vf{v}_{m-1}^n+\beta \vf{v}_m^n+\gamma \vf{v}_{m+1}^n$$ with $k/h=\lambda=\const$ Then, if the scheme is convergent, we have $\abs{a_i\lambda}\leq 1$ $\forall a_i\in\sigma(\vf{A})$.
  \end{theorem}
  \begin{proof}
    Suppose $\abs{a_i\lambda}>1$ for some eigenvalue $a_i$ and let $\vf{u}_0(x)=\vf{c}\indi{\{\abs{x}> \frac{1}{\abs{\lambda}}\}}$ with $\vf{c}=(c_1,\ldots,c_q)$ and $c_i\ne 0$. As shown in figure \mcref{NIPDE:courant-friedrichs-lewy_fig} the numerical solution at $\vf{u}(1,0)$ will have the $i$-th component always equal to 0, whereas in general the exact solution won't be.
    \begin{figure}[H]
      \centering
      \includestandalone[mode=image|tex,width=\linewidth]{Images/courant-friedrichs-lewy}
      \caption{Finite difference scheme (blue) versus the characteristic lines (in red). The arrows inward a bullet come from the points from which it depends.}
      \label{NIPDE:courant-friedrichs-lewy_fig}
    \end{figure}
  \end{proof}
  % \begin{theorem}
  %   There are no explicit, unconditionally stable, consistent finite difference schemes for hyperbolic systems of partial differential equations.
  % \end{theorem}
  \subsubsection{Von Neumann stability analysis}
  \begin{definition}
    Let $P_{k,h}{v}={f}$ be a finite difference scheme. For each $n\in\NN$, let ${\hat{v}}^n\in L^2\left(\left[-\frac{\pi}{h},\frac{\pi}{h}\right]\right)$ be the function defined as the Fourier series: $${\hat{v}}^n(\xi)=\sum_{m\in\ZZ}{v}_{m}^n\exp{-\ii m h \xi}$$ Hence $\displaystyle {v}_m^n=\frac{h}{2\pi}\int_{-\pi/h}^{\pi/h} {\hat{v}}^n(\xi)\exp{\ii mh \xi}\dd{\xi}$. We denote by ${v}^n:=({v}_m^n)\in\ell^2(\ZZ)$. We define the \emph{amplification factor} as the $2\pi$-periodic function in $\theta$, $g(\theta, k, h)$ that satisfies:
    $${\hat{v}}^{n+1}(\xi)=g(\xi h,k,h){\hat{v}}^n(\xi)$$
  \end{definition}
  \begin{theorem}
    Let $P_{k,h}{v}={f}$ be a one-step finite difference scheme with constant coefficients whose amplification factor $g(\theta,k,h)$ is continuous on $\RR\times\Lambda$, where $(k,h)\in\Lambda$ is a stability region. Then:
    \begin{enumerate}
      \item If $\exists K>0$ such that $\forall\theta\in\RR$ and $\forall(k,h)\in\Lambda$ we have $\abs{g(\theta,k,h)}\leq 1+Kk$, then the scheme is stable in $\Lambda$.
      \item If $\forall K>0$ and $\forall\varepsilon>0$ $\exists\theta\in\RR$ and $\exists(k,h)\in\Lambda$ with $k<\varepsilon$ such that $\abs{g(\theta, k,h)}>1+Kk$, then the scheme is unstable.
    \end{enumerate}
  \end{theorem}
  \begin{proof}
    \begin{enumerate}
      \item We have that $${\hat{v}}^{n}(\xi)={(g(\xi h,k,h))}^n{\hat{v}}^0(\xi)$$ Therefore applying twice the \mcref{MA:parseval}:
            \begin{align*}
              {\norm{{v}^n}_2}^2 & =\sum_{m\in\ZZ}\abs{{v}_m^n}^2                                                      \\
                                 & =\frac{h}{2\pi}\int_{-\pi/h}^{\pi/h} \abs{\hat{v}^n(\xi)}^2\dd{\xi}                 \\
                                 & \leq{(1+Kk)}^{2n}\frac{h}{2\pi}\int_{-\pi/h}^{\pi/h} \abs{\hat{v}^0(\xi)}^2\dd{\xi} \\
                                 & ={(1+Kk)}^{2n} {\norm{{v}^0}_2}^2
            \end{align*}
            And note that $\forall T>0$ with $nk\leq T$ we have that:
            \begin{multline*}
              {(1+Kk)}^{2n}\leq{(1+Kk)}^{2\frac{T}{k}}={\left({(1+Kk)}^\frac{1}{Kk}\right)}^{2 K T}\leq\\\leq \exp{2K T}=:C_T
            \end{multline*}
            because $\sup_{x>0}{(1+x)}^{1/x}=\exp{}$.
      \item Let $T\geq 2$, $K>0$, and $\theta_0,h,k$ be the ones of the hypothesis with $\varepsilon=\min(1,\frac{1}{K})$. Hence, $k\leq 1$ and $Kk\leq 1$. By the continuity of $g$, $\exists \theta_1,\theta_2\in\RR$ such that $\abs{g(\theta, k,h)}>1+Kk$ $\forall\theta\in[\theta_1,\theta_2]$. Let $\hat{v}^0(\xi):=\sqrt{\frac{2\pi}{h(\theta_2-\theta_1)}}\indi{\left[\frac{\theta_1}{h},\frac{\theta_2}{h}\right]}$ and denote $v^0:=(v_m^0)\in\ell^2(\ZZ)$ its inverse transform. An easy check using show that $\norm{v^0}_2=1$. Now take $n:=\lfloor T/k \rfloor$. Thus:
            \begin{align*}
              {\norm{v^n}_2}^2 & =\frac{h}{2\pi}\int_{-\pi/h}^{\pi/h} \abs{\hat{v}^n(\xi)}^2\dd{\xi}                        \\
                               & =\frac{h}{2\pi}\int_{-\pi/h}^{\pi/h} \abs{g(h\xi, k,h)}^{2n}\abs{\hat{v}^0(\xi)}^2\dd{\xi} \\
                               & >{(1+Kk)}^{2n}                                                                             \\
                               & >{(1+Kk)}^{\frac{2}{k}}                                                                    \\
                               & ={\left({(1+Kk)}^{\frac{1}{Kk}}\right)}^{2K}                                               \\
                               & \geq 2^{2K}                                                                                \\
                               & =2^{2K}{\norm{v^0}_2}^2
            \end{align*}
            where the penultimate step is because $\inf_{x\in[0,1]}{(1+x)}^{1/x}=2$.
            Hence the scheme is unstable.
    \end{enumerate}
  \end{proof}
\end{multicols}
\end{document}